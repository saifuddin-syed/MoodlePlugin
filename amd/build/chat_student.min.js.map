{"version":3,"file":"chat_student.min.js","sources":["../src/chat_student.js"],"sourcesContent":["define(['jquery'], function($) {\r\n    'use strict';\r\n\r\n    let config = null;\r\n\r\n    function initConfig(cfg) {\r\n        config = cfg;\r\n    }\r\n\r\n    function saveMessageToDB(message, sender) {\r\n        if (!config || !config.currentcourseid) {\r\n            console.error('Student config not initialized');\r\n            return;\r\n        }\r\n        return $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            dataType: 'json',\r\n            data: {\r\n                action: 'save_message',\r\n                courseid: config.currentcourseid,\r\n                message: message,\r\n                sender: sender,\r\n                sesskey: M.cfg.sesskey\r\n            }\r\n        });\r\n    }\r\n\r\n    function loadHistory(appendMessage) {\r\n        if (!config || !config.currentcourseid) {\r\n            console.error('Student config not initialized');\r\n            return;\r\n        }\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            data: {\r\n                action: 'fetch_history',\r\n                courseid: config.currentcourseid,\r\n                sesskey: M.cfg.sesskey\r\n            },\r\n            success: function(res) {\r\n                if (typeof res === 'string') {\r\n                    res = JSON.parse(res);\r\n                }\r\n                $('#chatbot-messages').empty();\r\n\r\n                res.forEach(msg => {\r\n                    appendMessage(msg.message, msg.sender, parseInt(msg.timecreated), false);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function insertDummyQuiz() {\r\n        if (!config || !config.currentcourseid) {\r\n            console.error('Student config not initialized');\r\n            return;\r\n        }\r\n        return $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            data: {\r\n                action: 'insert_dummy_quiz',\r\n                courseid: config.currentcourseid,\r\n                sesskey: M.cfg.sesskey\r\n            }\r\n        });\r\n    }\r\n\r\n    function askRAG(message) {\r\n        return $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            dataType: 'json',\r\n            data: {\r\n                action: 'ask_rag',\r\n                courseid: config.currentcourseid,\r\n                question: message,\r\n                sesskey: M.cfg.sesskey\r\n            }\r\n        });\r\n    }\r\n\r\n    return {\r\n        initConfig: initConfig,\r\n        saveMessageToDB: saveMessageToDB,\r\n        loadHistory: loadHistory,\r\n        insertDummyQuiz: insertDummyQuiz,\r\n        askRAG: askRAG\r\n    };\r\n});"],"names":["define","$","config","initConfig","cfg","saveMessageToDB","message","sender","currentcourseid","ajax","url","M","wwwroot","method","dataType","data","action","courseid","sesskey","console","error","loadHistory","appendMessage","success","res","JSON","parse","empty","forEach","msg","parseInt","timecreated","insertDummyQuiz","askRAG","question"],"mappings":"AAAAA,uCAAO,CAAC,WAAW,SAASC,OAGpBC,OAAS,WAiFN,CACHC,oBAhFgBC,KAChBF,OAASE,KAgFTC,yBA7EqBC,QAASC,WACzBL,QAAWA,OAAOM,uBAIhBP,EAAEQ,KAAK,CACVC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,OAAQ,eACRC,SAAUf,OAAOM,gBACjBF,QAASA,QACTC,OAAQA,OACRW,QAASP,EAAEP,IAAIc,WAZnBC,QAAQC,MAAM,mCA4ElBC,qBA3DiBC,eACZpB,QAAWA,OAAOM,gBAIvBP,EAAEQ,KAAK,CACHC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRE,KAAM,CACFC,OAAQ,gBACRC,SAAUf,OAAOM,gBACjBU,QAASP,EAAEP,IAAIc,SAEnBK,QAAS,SAASC,KACK,iBAARA,MACPA,IAAMC,KAAKC,MAAMF,MAErBvB,EAAE,qBAAqB0B,QAEvBH,IAAII,SAAQC,MACRP,cAAcO,IAAIvB,QAASuB,IAAItB,OAAQuB,SAASD,IAAIE,cAAc,SAlB1EZ,QAAQC,MAAM,mCA0DlBY,8BAjCK9B,QAAWA,OAAOM,uBAIhBP,EAAEQ,KAAK,CACVC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRE,KAAM,CACFC,OAAQ,oBACRC,SAAUf,OAAOM,gBACjBU,QAASP,EAAEP,IAAIc,WATnBC,QAAQC,MAAM,mCAiClBa,gBAnBY3B,gBACLL,EAAEQ,KAAK,CACVC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,OAAQ,UACRC,SAAUf,OAAOM,gBACjB0B,SAAU5B,QACVY,QAASP,EAAEP,IAAIc"}