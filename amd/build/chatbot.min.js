define("local_automation/chatbot",["jquery","core/templates"],(function($,Templates){let currentMode="assistant";function getStorageKey(){return"ai_chat_history_"+currentMode}function loadHistory(){$("#chatbot-messages").empty();let history=localStorage.getItem(getStorageKey());history&&(history=JSON.parse(history),history.forEach((msg=>appendMessage(msg.text,msg.sender,!1))),scrollMessagesToBottom())}function saveMessage(text,sender){let history=localStorage.getItem(getStorageKey());history=history?JSON.parse(history):[],history.push({text:text,sender:sender}),localStorage.setItem(getStorageKey(),JSON.stringify(history))}function appendMessage(text,sender){let store=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const className="user"===sender?"msg-user":"msg-bot";$("#chatbot-messages").append('<div class="message '.concat(className,'">').concat(text,"</div>")),store&&saveMessage(text,sender),scrollMessagesToBottom()}function scrollMessagesToBottom(){const msgBox=$("#chatbot-messages")[0];msgBox&&msgBox.scrollTo({top:msgBox.scrollHeight,behavior:"smooth"})}function handleSend(){const input=$("#chatbot-input"),text=input.val().trim();text&&(appendMessage(text,"user"),console.log("[".concat(currentMode,"] User typed:"),text),input.val(""),setTimeout((()=>{appendMessage("Working in ".concat(currentMode," mode âœ…"),"bot")}),600))}function bindEvents(){$("#ai-chatbot-button").on("click",(()=>{$("#ai-chatbot-modal").toggleClass("hidden"),$("#chatbot-input").focus()})),$("#chatbot-close-btn").on("click",(()=>{$("#ai-chatbot-modal").addClass("hidden")})),$("#chatbot-send-btn").on("click",handleSend),$("#chatbot-input").on("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),handleSend())})),$(".chat-tab").on("click",(function(){!function(newMode){if(newMode===currentMode)return;currentMode=newMode,console.log("Switched to mode: ".concat(currentMode)),$(".chat-tab").removeClass("active"),$('.chat-tab[data-mode="'.concat(currentMode,'"]')).addClass("active");const headerText={assistant:"AI Assistant",qb:"QB Generator",quiz:"Quiz Generator"}[currentMode];$(".chat-header span").text(headerText),loadHistory()}($(this).data("mode"))}))}return{init:function(){document.getElementById("chatbot-style")||$("head").append('<link id="chatbot-style" rel="stylesheet" href="'+M.cfg.wwwroot+'/local/automation/style/chatbot.css">'),Templates.render("local_automation/chatbot",{}).then((html=>{$("body").append(html),bindEvents(),loadHistory()})).catch((err=>console.error("Chatbot template load failed:",err)))}}}));

//# sourceMappingURL=chatbot.min.js.map