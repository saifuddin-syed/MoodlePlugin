{"version":3,"file":"student_quiz.min.js","sources":["../src/student_quiz.js"],"sourcesContent":["define(['jquery'], function($) {\r\n\r\n    return {\r\n        init: function(courseid) {\r\n\r\n            console.log(\"student_quiz.js loaded\");\r\n            console.log(\"Course ID received:\", courseid);\r\n\r\n            if (!courseid) {\r\n                console.error(\"Course ID not received in JS\");\r\n                return;\r\n            }\r\n\r\n\r\n            $(function() {\r\n\r\n                const apiBase = \"http://127.0.0.1:8000\";\r\n                const quizContainer = $('#quizContainer');\r\n                const unitContainer = $('#unitContainer');\r\n\r\n                let currentQuestions = [];\r\n                let totalTime = 0;\r\n                let timerInterval = null;\r\n                \r\n                    // ============================================\r\n                    // LOAD UNITS + SECTIONS (FROM JSON)\r\n                    // ============================================\r\n                \r\n                    $.get(apiBase + \"/topics\", function(data) {\r\n                        console.log(\"Topics response:\", data);\r\n                    \r\n                        unitContainer.empty();\r\n                    \r\n                        data.topics.forEach(function(topic) {\r\n                        \r\n                            const unitBlock = $('<div style=\"margin-bottom:10px;\">');\r\n                        \r\n                            const unitCheckbox = $(`\r\n                                <label>\r\n                                    <input type=\"checkbox\" class=\"unit-checkbox\" value=\"${topic.unit}\">\r\n                                    <strong>${topic.unit}</strong>\r\n                                </label>\r\n                            `);\r\n                            \r\n                            unitBlock.append(unitCheckbox);\r\n                            \r\n                            topic.sections.forEach(function(sectionObj) {\r\n                            \r\n                                const sectionCheckbox = $(`\r\n                                    <div style=\"margin-left:20px;\">\r\n                                        <label>\r\n                                            <input type=\"checkbox\"\r\n                                                   class=\"section-checkbox\"\r\n                                                   data-unit=\"${topic.unit}\"\r\n                                                   value=\"${sectionObj.section}\">\r\n                                            ${sectionObj.section} - ${sectionObj.title}\r\n                                        </label>\r\n                                    </div>\r\n                                `);\r\n                                \r\n                                unitBlock.append(sectionCheckbox);\r\n                            });\r\n                        \r\n                            unitContainer.append(unitBlock);\r\n                        });\r\n                    \r\n                    });\r\n                \r\n                    // ============================================\r\n                    // UNIT CHECKBOX → SELECT ALL SECTIONS\r\n                    // ============================================\r\n                \r\n                    $(document).on('change', '.unit-checkbox', function() {\r\n                    \r\n                        const unit = $(this).val();\r\n                        const isChecked = $(this).is(':checked');\r\n                    \r\n                        $(`.section-checkbox[data-unit=\"${unit}\"]`)\r\n                            .prop('checked', isChecked);\r\n                    });\r\n                \r\n                    // ============================================\r\n                    // SECTION CHECKBOX → AUTO UPDATE UNIT CHECKBOX\r\n                    // ============================================\r\n                \r\n                    $(document).on('change', '.section-checkbox', function() {\r\n                    \r\n                        const unit = $(this).data('unit');\r\n                    \r\n                        const totalSections =\r\n                            $(`.section-checkbox[data-unit=\"${unit}\"]`).length;\r\n                    \r\n                        const checkedSections =\r\n                            $(`.section-checkbox[data-unit=\"${unit}\"]:checked`).length;\r\n                    \r\n                        if (checkedSections === totalSections) {\r\n                            $(`.unit-checkbox[value=\"${unit}\"]`)\r\n                                .prop('checked', true);\r\n                        } else {\r\n                            $(`.unit-checkbox[value=\"${unit}\"]`)\r\n                                .prop('checked', false);\r\n                        }\r\n                    });\r\n                \r\n                    // ============================================\r\n                    // GENERATE QUIZ\r\n                    // ============================================\r\n                \r\n                    $('#generateQuizBtn').off('click').on('click', function() {\r\n                    \r\n                        let selectedUnits = [];\r\n                        let selectedSections = [];\r\n                    \r\n                        $('.unit-checkbox:checked').each(function() {\r\n                            selectedUnits.push($(this).val());\r\n                        });\r\n                    \r\n                        $('.section-checkbox:checked').each(function() {\r\n                            selectedSections.push({\r\n                                unit: $(this).data('unit'),\r\n                                section: $(this).val()\r\n                            });\r\n                        });\r\n                    \r\n                        if (selectedUnits.length === 0 && selectedSections.length === 0) {\r\n                            alert(\"Select at least one unit or section.\");\r\n                            return;\r\n                        }\r\n                    \r\n                        if (selectedUnits.length > 3) {\r\n                            alert(\"Maximum 3 units allowed.\");\r\n                            return;\r\n                        }\r\n                    \r\n                        const numQuestions = parseInt($('#questionCount').val());\r\n                        const difficulty = $('#difficulty').val();\r\n                    \r\n                        if (!numQuestions || numQuestions <= 0) {\r\n                            alert(\"Enter valid number of questions.\");\r\n                            return;\r\n                        }\r\n                    \r\n                        // ============================\r\n                        // TIMER CALCULATION\r\n                        // ============================\r\n                    \r\n                        let timePerQuestion = 60; // easy\r\n                    \r\n                        if (difficulty === 'medium') timePerQuestion = 120;\r\n                        if (difficulty === 'hard') timePerQuestion = 150;\r\n                    \r\n                        totalTime = numQuestions * timePerQuestion;\r\n                    \r\n                        quizContainer.html(\"<p>Generating quiz...</p>\");\r\n                    \r\n                        $.ajax({\r\n                            url: apiBase + \"/generate-quiz\",\r\n                            method: \"POST\",\r\n                            contentType: \"application/json\",\r\n                            data: JSON.stringify({\r\n                                units: selectedUnits,\r\n                                sections: selectedSections,\r\n                                num_questions: numQuestions,\r\n                                difficulty: difficulty\r\n                            }),\r\n                            success: function(data) {\r\n                            \r\n                                console.log(\"Quiz API response:\", data);\r\n\r\n                                if (!data || data.ok !== true) {\r\n                                    quizContainer.html(\"<p>\" + (data.error || \"Quiz generation failed.\") + \"</p>\");\r\n                                    return;\r\n                                }\r\n                            \r\n                                if (!Array.isArray(data.questions) || data.questions.length === 0) {\r\n                                    quizContainer.html(\"<p>No questions generated.</p>\");\r\n                                    return;\r\n                                }\r\n                            \r\n                                // currentQuestions = data.questions;\r\n                            \r\n                                // renderQuiz(data.questions);\r\n                                // startTimer();\r\n                                // enableExamProtection();\r\n                                // Redirect to attempt page via POST\r\n                                const form = $('<form>', {\r\n                                    method: 'POST',\r\n                                    action: M.cfg.wwwroot + '/local/automation/student_quiz_attempt.php'\r\n                                });\r\n\r\n                                form.append(`<input type=\"hidden\" name=\"sesskey\" value=\"${M.cfg.sesskey}\">`);\r\n                                form.append(`<input type=\"hidden\" name=\"courseid\" value=\"${courseid}\">`);\r\n                                form.append(`<input type=\"hidden\" name=\"difficulty\" value=\"${difficulty}\">`);\r\n                                form.append(`<input type=\"hidden\" name=\"totalquestions\" value=\"${data.questions.length}\">`);\r\n                                form.append(`<input type=\"hidden\" name=\"quizjson\" value='${JSON.stringify(data.questions)}'>`);\r\n\r\n                                // Add selected topics\r\n                                selectedUnits.forEach(function(u) {\r\n                                    form.append(`<input type=\"hidden\" name=\"topics[]\" value=\"${u}\">`);\r\n                                });\r\n\r\n                                $('body').append(form);\r\n                                form.submit();\r\n                            },\r\n                            error: function() {\r\n                                quizContainer.html(\"<p>Server error.</p>\");\r\n                            }\r\n                        });\r\n                    });\r\n                \r\n                    // ============================================\r\n                    // RENDER QUIZ\r\n                    // ============================================\r\n                \r\n                    function renderQuiz(questions) {\r\n                    \r\n                        clearInterval(timerInterval);\r\n                    \r\n                        quizContainer.empty();\r\n                    \r\n                        const timerDiv = $('<div id=\"timer\" style=\"position:fixed; top:20px; right:20px; font-weight:bold; font-size:18px;\"></div>');\r\n                        quizContainer.append(timerDiv);\r\n                    \r\n                        const form = $('<form id=\"quizForm\">');\r\n                    \r\n                        questions.forEach(function(q, index) {\r\n                        \r\n                            const block = $('<div class=\"question-block\" style=\"margin-bottom:20px;\">');\r\n                        \r\n                            block.append(`<p><strong>Q${index + 1}:</strong> ${q.question}</p>`);\r\n                        \r\n                            q.options.forEach(function(optionText, optIndex) {\r\n                            \r\n                                const label = $(`\r\n                                    <label>\r\n                                        <input type=\"radio\" name=\"q${index}\" value=\"${optIndex}\">\r\n                                        ${optionText}\r\n                                    </label><br>\r\n                                `);\r\n                                \r\n                                block.append(label);\r\n                            });\r\n                        \r\n                            block.attr(\"data-correct\", q.answer_index);\r\n                        \r\n                            form.append(block);\r\n                        });\r\n                    \r\n                        const submitBtn = $('<button type=\"button\">Submit Quiz</button>');\r\n                    \r\n                        submitBtn.on('click', function() {\r\n                            submitQuiz(form);\r\n                        });\r\n                    \r\n                        form.append(submitBtn);\r\n                        quizContainer.append(form);\r\n                    }\r\n                \r\n                    // ============================================\r\n                    // TIMER\r\n                    // ============================================\r\n                \r\n                    function startTimer() {\r\n                    \r\n                        updateTimerDisplay();\r\n                    \r\n                        timerInterval = setInterval(function() {\r\n                        \r\n                            totalTime--;\r\n                        \r\n                            updateTimerDisplay();\r\n                        \r\n                            if (totalTime <= 0) {\r\n                                clearInterval(timerInterval);\r\n                                alert(\"Time is up!\");\r\n                                submitQuiz($('#quizForm'));\r\n                            }\r\n                        \r\n                        }, 1000);\r\n                    }\r\n                \r\n                    function updateTimerDisplay() {\r\n                    \r\n                        let minutes = Math.floor(totalTime / 60);\r\n                        let seconds = totalTime % 60;\r\n                    \r\n                        $('#timer').text(\r\n                            String(minutes).padStart(2, '0') + \":\" +\r\n                            String(seconds).padStart(2, '0')\r\n                        );\r\n                    }\r\n                \r\n                    // ============================================\r\n                    // SUBMIT QUIZ\r\n                    // ============================================\r\n                \r\n                    function submitQuiz(form) {\r\n                    \r\n                        clearInterval(timerInterval);\r\n                    \r\n                        let score = 0;\r\n                    \r\n                        form.find(\".question-block\").each(function() {\r\n                        \r\n                            const selected = $(this).find(\"input:checked\");\r\n                            const correct = parseInt($(this).attr(\"data-correct\"));\r\n                        \r\n                            if (selected.length &&\r\n                                parseInt(selected.val()) === correct) {\r\n                                score++;\r\n                            }\r\n                        });\r\n                    \r\n                        quizContainer.html(`\r\n                            <h3>Quiz Completed</h3>\r\n                            <p>Your Score: ${score} / ${currentQuestions.length}</p>\r\n                        `);\r\n                    }\r\n                \r\n                    // ============================================\r\n                    // BASIC EXAM PROTECTION\r\n                    // ============================================\r\n                \r\n                    function enableExamProtection() {\r\n                    \r\n                        $(document).on('contextmenu', function(e) {\r\n                            e.preventDefault();\r\n                        });\r\n                    \r\n                        $(document).on('copy', function(e) {\r\n                            e.preventDefault();\r\n                        });\r\n                    \r\n                        $(document).on('keydown', function(e) {\r\n                            if (e.ctrlKey) {\r\n                                e.preventDefault();\r\n                            }\r\n                        });\r\n                    \r\n                        history.pushState(null, null, location.href);\r\n                        window.onpopstate = function () {\r\n                            history.go(1);\r\n                        };\r\n                    }\r\n      \r\n            }); \r\n\r\n        }\r\n    };\r\n});"],"names":["define","$","init","courseid","console","log","quizContainer","unitContainer","totalTime","get","apiBase","data","empty","topics","forEach","topic","unitBlock","unitCheckbox","unit","append","sections","sectionObj","sectionCheckbox","section","title","document","on","this","val","isChecked","is","prop","totalSections","length","off","selectedUnits","selectedSections","each","push","alert","numQuestions","parseInt","difficulty","timePerQuestion","html","ajax","url","method","contentType","JSON","stringify","units","num_questions","success","ok","error","Array","isArray","questions","form","action","M","cfg","wwwroot","sesskey","u","submit"],"mappings":"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"}